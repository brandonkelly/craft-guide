{# /**
 * Guide plugin for Craft CMS
 *
 * Guide Widget Body
 *
 * @author    Will Browar
 * @copyright Copyright (c) 2021 Will Browar
 * @link      https://wbrowar.com
 * @package   Guide
 * @since     3.0.0
 */ #}

{% if guides|length or (inlineEditorId ?? false) %}
  {% set displaySlug = 'guide-' ~ (displayId ?? 'display') %}

  {% set guideNav = [] %}
  {% if guides|length %}
    {% for guide in guides %}
      {% if not (teleportMap['id-' ~ guide.id] ?? false) %}
        {% set guideNav = guideNav|merge([{ id: guide.id, slug: guide.slug, title: guide.title }]) %}
      {% endif %}
    {% endfor %}
  {% endif %}

  <div
    {% if inlineEditorId ?? false %}data-enable-inline-editor{% endif %}
    data-guide-display="{{ displaySlug }}"
    {% if guideNav|length %}data-guide-nav-data="{{ guideNav|json_encode }}"{% endif %}
    {% if not guides|length %}data-start-in-inline-editor{% endif %}
    {% if teleportContainerClass ?? false %}data-teleport-container-class="{{ teleportContainerClass }}"{% endif %}
    {% if teleportMethod ?? false %}data-teleport-method="{{ teleportMethod }}"{% endif %}
    {% if teleportSelector ?? false %}data-teleport-selector="{{ teleportSelector }}"{% endif %}
  ></div>
  <template id="{{ displaySlug }}">
    <teleport :to="teleportTarget" :disabled="!teleportTarget">
      <div{% if guideNav|length > 1 %} class="g-grid g-grid-cols-[var(--grid-cols)] g-gap-6 g-relative" style="--grid-cols: 1fr 200px;"{% endif %}>
        {% if inlineEditorId ?? false %}<placement-inline-editor
          placement-inline-editor="{{ inlineEditorId }}"
          {% if placementId ?? false %}placement-id="{{ placementId }}"{% endif %}
          v-if="showInlineEditor"
        ></placement-inline-editor>{% endif %}
        <div {% if inlineEditorId ?? false %}v-else{% endif %}>
          {% if guides|length %}
            {% for guide in guides %}
              {% if teleportMap['id-' ~ guide.id] ?? false %}<teleport to="{{ teleportMap['id-' ~ guide.id] }}">{% endif %}
              <div
                class="guide guide-{{ guide.slug }} g-relative"
                :class="[showTldr ? 'guide-tldr' : null]"
                {% if not (teleportMap['id-' ~ guide.id] ?? false) and (guideNav|length > 1) %}v-if="currentGuide === '{{ guide.slug }}'"{% endif %}
              >
                {{ include('guide/_partials/render_content', { guide: guide }) }}
                <div class="guide-edit-button g-space-x-1 g-absolute g-top-0 g-right-0">
                  <button class="btn small g-duration-150" :class="[showTldr ? 'submit' : null]" type="button" @click="showTldr ? toggleTldr(false) : toggleTldr(true)" v-if="enableTldr">TL;DR</button>
                  <button class="btn small g-duration-150" type="button" @click="showInlineEditor = true" v-if="enableInlineEditor"><svg-settings class="g-h-4 g-w-4"></svg-settings></button>
                </div>
              </div>
              {% if teleportMap['id-' ~ guide.id] ?? false %}</teleport>{% endif %}
            {% endfor %}
          {% endif %}
        </div>
        {% if guideNav|length > 1 %}
          <div>
            <div class="g-sticky g-top-16">
              <h2>Guides</h2>
              <div class="g-space-y-2">
                {% for link in guideNav %}
                  <button class="g-block g-text-left g-text-sm g-cursor-pointer g-duration-150" :class="{ 'g-font-bold g-text-primary': currentGuide === '{{ link.slug }}' }" type="button" @click="currentGuide = '{{ link.slug }}'">{{ link.title }}</button>
                {% endfor %}
              </div>
            </div>
          </div>
        {% endif %}
      </div>
    </teleport>
  </template>
{% endif %}